const b4a = require('b4a')

/**

 * @param {string|number[]|Buffer} feedkey
 * @returns {Buffer|null}
 */
function parse_feed_key (feedkey) {
  let key_buffer = null

  if (typeof feedkey === 'string') {
    if (feedkey.includes(',')) {
      const numbers = feedkey.split(',').map(n => parseInt(n.trim(), 10))
      key_buffer = b4a.allocUnsafe(32)
      for (let i = 0; i < 32; i++) key_buffer[i] = numbers[i]
    } else {
      key_buffer = b4a.from(feedkey, 'hex')
    }
  } else if (Array.isArray(feedkey)) {
    key_buffer = b4a.from(feedkey)
  } else if (b4a.isBuffer(feedkey)) {
    key_buffer = feedkey
  }

  if (!key_buffer || key_buffer.length !== 32) {
    console.error('Invalid key length or format for feedkey:', feedkey)
    return null
  }
  return key_buffer
}

module.exports = {
  parse_feed_key
}